<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- =========== EVALUATION PLANNING RULES =========== -->
        <!-- HR Managers: See ALL planning records -->
        <record id="evaluation_planning_manager_rule" model="ir.rule">
            <field name="name">Evaluation Planning: HR Managers See All</field>
            <field name="model_id" ref="model_evaluation_planning"/>
            <field name="groups" eval="[(4, ref('hr.group_hr_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>

        <!-- HR Users: Only see plans they created OR active plans -->
        <record id="evaluation_planning_user_rule" model="ir.rule">
            <field name="name">Evaluation Planning: HR Users Limited</field>
            <field name="model_id" ref="model_evaluation_planning"/>
            <field name="groups" eval="[(4, ref('hr.group_hr_user'))]"/>
            <field name="domain_force">['|', ('create_uid', '=', user.id), ('state', '=', 'active')]</field>
        </record>

        <!-- =========== PERFORMANCE PLAN RULES =========== -->
        <!-- HR Managers: See ALL performance plans -->
        <record id="performance_plan_manager_rule" model="ir.rule">
            <field name="name">Performance Plan: HR Managers See All</field>
            <field name="model_id" ref="model_performance_plan"/>
            <field name="groups" eval="[(4, ref('hr.group_hr_manager'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>

        <!-- HR Users: Only see plans in their department OR plans they created -->
        <record id="performance_plan_user_rule" model="ir.rule">
            <field name="name">Performance Plan: HR Users Limited</field>
            <field name="model_id" ref="model_performance_plan"/>
            <field name="groups" eval="[(4, ref('hr.group_hr_user'))]"/>
            <field name="domain_force">
                ['|', ('create_uid', '=', user.id),
                      ('department_id', 'in', user.employee_ids.department_id.ids)]
            </field>
        </record>

        <!-- EMPLOYEES: Can only see THEIR OWN performance plans -->
        <record id="performance_plan_employee_rule" model="ir.rule">
            <field name="name">Performance Plan: Employee Own Records</field>
            <field name="model_id" ref="model_performance_plan"/>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="domain_force">[('employee_id.user_id', '=', user.id)]</field>
        </record>

        <!-- =========== KPI LINE RULES =========== -->
        <!-- Employees: Can only edit KPI lines in their own DRAFT plans -->
        <record id="kpi_line_employee_rule" model="ir.rule">
            <field name="name">KPI Line: Employee Edit Rights</field>
            <field name="model_id" ref="model_performance_plan_kpi_line"/>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
            <field name="domain_force">
                [('performance_plan_id.employee_id.user_id', '=', user.id),
                 ('performance_plan_id.state', '=', 'draft')]
            </field>
        </record>

        <!-- HR: Can see all KPI lines -->
        <record id="kpi_line_hr_rule" model="ir.rule">
            <field name="name">KPI Line: HR Access</field>
            <field name="model_id" ref="model_performance_plan_kpi_line"/>
            <field name="groups" eval="[(4, ref('hr.group_hr_user'))]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
        </record>
    </data>
</odoo>